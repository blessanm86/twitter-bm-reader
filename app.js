var express = require('express');
var path = require('path');

var app = express();

// view engine setup
app.set('views', path.join(__dirname, 'views'));
app.set('view engine', 'hbs');

var middlewares = {
  morgan:  require('./middlewares/morgan'),
  session: require('./middlewares/express-session'),
  favicon: require('./middlewares/serve-favicon'),
  cookie:  require('./middlewares/cookie-parser'),
  static:  require('./middlewares/static'),
  grant:  require('./middlewares/grant-express'),
};

app.use(middlewares.morgan('dev'));
app.use(middlewares.session({secret:'very secret'}));
app.use(middlewares.favicon(path.join(__dirname ,'public/images/favicon.ico')));
app.use(middlewares.cookie());
app.use(middlewares.static(path.join(__dirname, 'public')));
app.use(middlewares.grant);

var routes = require('./routes/index');
var twitter = require('./app_modules/twitter-api');
var tweetToHTML = require('tweet-to-html');

app.use('/', routes);

app.get('/twitter/authorised/', function (req, res) {
  // db('users').push({
  //   name: req.session.grant.response.raw.screen_name,
  //   accessToken: req.session.grant.response.access_token,
  //   accessSecret: req.session.grant.response.access_secret
  // });

  res.redirect('/'+ req.session.grant.response.raw.screen_name + '/');
});

//Checks if twitter session is set. Elese redirect for login.
app.use(function(req, res, next) {
  if(!req.session.grant) {
    res.redirect('/');
  } else {
    next();
  }
});

app.get('/:username/', function(req, res) {
  try {
    //res.render('home', { screen_name: req.session.grant.response.raw.screen_name });
    res.render('home');
  } catch(e) {
    res.redirect('/');
  }
});

//api to fetch profile information
app.get('/:username/profile/', function(req, res) {
  var response = res;

  twitter(req, res, function() {
    return {
      path: 'users/show',
      condition: {screen_name: req.session.grant.response.raw.screen_name}
    }
  }, function(err,res, body) {
    if(err) {
      response.status(401).json(err);
    } else {
      response.status(200).json(body);
    }
  });

  // var profile = {"id":1565774833,"id_str":"1565774833","name":"Blessan Mathew","screen_name":"blessenm86","location":"India","profile_location":null,"description":"Javascript Programmer, Mobility Developer at Cognizant Technology Solutions. From Kerala, India","url":"http://t.co/qXK9JqyPoF","entities":{"url":{"urls":[{"url":"http://t.co/qXK9JqyPoF","expanded_url":"http://www.blessanmathew.com","display_url":"blessanmathew.com","indices":[0,22]}]},"description":{"urls":[]}},"protected":false,"followers_count":110,"friends_count":355,"listed_count":20,"created_at":"Wed Jul 03 13:12:18 +0000 2013","favourites_count":124,"utc_offset":null,"time_zone":null,"geo_enabled":false,"verified":false,"statuses_count":911,"lang":"en","status":{"created_at":"Thu Oct 15 15:33:56 +0000 2015","id":654681619635138600,"id_str":"654681619635138560","text":"RT @HugoGiraudel: Amazing overview of ES6 in 350 bullet points by @ponyfoo: https://t.co/lpUDc6WPMn.","source":"<a href=\"http://twitter.com/download/android\" rel=\"nofollow\">Twitter for Android</a>","truncated":false,"in_reply_to_status_id":null,"in_reply_to_status_id_str":null,"in_reply_to_user_id":null,"in_reply_to_user_id_str":null,"in_reply_to_screen_name":null,"geo":null,"coordinates":null,"place":null,"contributors":null,"retweeted_status":{"created_at":"Thu Oct 15 15:27:25 +0000 2015","id":654679980274643000,"id_str":"654679980274642949","text":"Amazing overview of ES6 in 350 bullet points by @ponyfoo: https://t.co/lpUDc6WPMn.","source":"<a href=\"https://about.twitter.com/products/tweetdeck\" rel=\"nofollow\">TweetDeck</a>","truncated":false,"in_reply_to_status_id":null,"in_reply_to_status_id_str":null,"in_reply_to_user_id":null,"in_reply_to_user_id_str":null,"in_reply_to_screen_name":null,"geo":null,"coordinates":null,"place":null,"contributors":null,"retweet_count":9,"favorite_count":23,"entities":{"hashtags":[],"symbols":[],"user_mentions":[{"screen_name":"ponyfoo","name":"Pony Foo","id":1447284511,"id_str":"1447284511","indices":[48,56]}],"urls":[{"url":"https://t.co/lpUDc6WPMn","expanded_url":"https://ponyfoo.com/articles/es6","display_url":"ponyfoo.com/articles/es6","indices":[58,81]}]},"favorited":true,"retweeted":true,"possibly_sensitive":false,"lang":"en"},"retweet_count":9,"favorite_count":0,"entities":{"hashtags":[],"symbols":[],"user_mentions":[{"screen_name":"HugoGiraudel","name":"Hugo Giraudel","id":551949534,"id_str":"551949534","indices":[3,16]},{"screen_name":"ponyfoo","name":"Pony Foo","id":1447284511,"id_str":"1447284511","indices":[66,74]}],"urls":[{"url":"https://t.co/lpUDc6WPMn","expanded_url":"https://ponyfoo.com/articles/es6","display_url":"ponyfoo.com/articles/es6","indices":[76,99]}]},"favorited":true,"retweeted":true,"possibly_sensitive":false,"lang":"en"},"contributors_enabled":false,"is_translator":false,"is_translation_enabled":false,"profile_background_color":"C0DEED","profile_background_image_url":"http://abs.twimg.com/images/themes/theme1/bg.png","profile_background_image_url_https":"https://abs.twimg.com/images/themes/theme1/bg.png","profile_background_tile":false,"profile_image_url":"http://pbs.twimg.com/profile_images/378800000082186023/8bb9ca172b27c49a5d0d3eb79e8d11fc_normal.jpeg","profile_image_url_https":"https://pbs.twimg.com/profile_images/378800000082186023/8bb9ca172b27c49a5d0d3eb79e8d11fc_normal.jpeg","profile_banner_url":"https://pbs.twimg.com/profile_banners/1565774833/1401072511","profile_link_color":"0084B4","profile_sidebar_border_color":"C0DEED","profile_sidebar_fill_color":"DDEEF6","profile_text_color":"333333","profile_use_background_image":true,"has_extended_profile":false,"default_profile":true,"default_profile_image":false,"following":false,"follow_request_sent":false,"notifications":false,"suspended":false,"needs_phone_verification":false};
  // res.status(200).json(profile);
});

//api to tweets
app.get('/:username/tweets/', function(req, res) {
  var response = res;

  twitter(req, res, function() {
    return {
      path: 'statuses/home_timeline',
      condition: {count: 10}
    }
  }, function(err,res, body) {
    if(err) {
      response.status(401).json(err);
    } else {
      response.status(200).json(tweetToHTML.parse(body));
    }
  });

  // var tweets = [{"created_at":"Tue Oct 27 09:59:04 +0000 2015","id":658946003354132500,"id_str":"658946003354132480","text":"RT @ashic: 15 year old hacked @talktalk 's garbage security? Give him a scholarship for crying out loud. What's the point of arresting him?…","source":"<a href=\"http://www.twitter.com\" rel=\"nofollow\">Twitter for Windows Phone</a>","truncated":false,"in_reply_to_status_id":null,"in_reply_to_status_id_str":null,"in_reply_to_user_id":null,"in_reply_to_user_id_str":null,"in_reply_to_screen_name":null,"user":{"id":160514302,"id_str":"160514302","name":"Richard Dalton","screen_name":"richardadalton","location":"Kildare, Ireland","description":"I write code, as a last resort. I make it simple, when I can. Please visit: http://t.co/GtWXf7dbfa","url":"http://t.co/mArwXmywZl","entities":{"url":{"urls":[{"url":"http://t.co/mArwXmywZl","expanded_url":"http://www.devjoy.com","display_url":"devjoy.com","indices":[0,22]}]},"description":{"urls":[{"url":"http://t.co/GtWXf7dbfa","expanded_url":"http://freepaconow.com","display_url":"freepaconow.com","indices":[76,98]}]}},"protected":false,"followers_count":1069,"friends_count":504,"listed_count":97,"created_at":"Mon Jun 28 11:27:14 +0000 2010","favourites_count":231,"utc_offset":null,"time_zone":null,"geo_enabled":true,"verified":false,"statuses_count":28390,"lang":"en","contributors_enabled":false,"is_translator":false,"is_translation_enabled":false,"profile_background_color":"C0DEED","profile_background_image_url":"http://pbs.twimg.com/profile_background_images/687927535/b2ebf72ba8fc96d4e126d2810c37467a.jpeg","profile_background_image_url_https":"https://pbs.twimg.com/profile_background_images/687927535/b2ebf72ba8fc96d4e126d2810c37467a.jpeg","profile_background_tile":false,"profile_image_url":"http://pbs.twimg.com/profile_images/629300041455435776/dCbJf6WT_normal.jpg","profile_image_url_https":"https://pbs.twimg.com/profile_images/629300041455435776/dCbJf6WT_normal.jpg","profile_banner_url":"https://pbs.twimg.com/profile_banners/160514302/1357347025","profile_link_color":"0084B4","profile_sidebar_border_color":"FFFFFF","profile_sidebar_fill_color":"DDEEF6","profile_text_color":"333333","profile_use_background_image":true,"has_extended_profile":false,"default_profile":false,"default_profile_image":false,"following":true,"follow_request_sent":false,"notifications":false},"geo":null,"coordinates":null,"place":null,"contributors":null,"retweeted_status":{"created_at":"Tue Oct 27 09:57:42 +0000 2015","id":658945658267811800,"id_str":"658945658267811840","text":"15 year old hacked @talktalk 's garbage security? Give him a scholarship for crying out loud. What's the point of arresting him? #shame","source":"<a href=\"http://mvilla.it/fenix\" rel=\"nofollow\">Fenix for Android</a>","truncated":false,"in_reply_to_status_id":null,"in_reply_to_status_id_str":null,"in_reply_to_user_id":null,"in_reply_to_user_id_str":null,"in_reply_to_screen_name":null,"user":{"id":50371199,"id_str":"50371199","name":"Ashic Mahtab","screen_name":"ashic","location":"Greenwich, London","description":"http://t.co/D4PMWXEf MVP - CQRS / Event Sourcing / http://t.co/D4PMWXEf / MVC / .NET nut...","url":"http://t.co/mt90PPmC6e","entities":{"url":{"urls":[{"url":"http://t.co/mt90PPmC6e","expanded_url":"http://www.heartysoft.com","display_url":"heartysoft.com","indices":[0,22]}]},"description":{"urls":[{"url":"http://t.co/D4PMWXEf","expanded_url":"http://ASP.NET","display_url":"ASP.NET","indices":[0,20]},{"url":"http://t.co/D4PMWXEf","expanded_url":"http://ASP.NET","display_url":"ASP.NET","indices":[51,71]}]}},"protected":false,"followers_count":1305,"friends_count":745,"listed_count":100,"created_at":"Wed Jun 24 17:28:06 +0000 2009","favourites_count":219,"utc_offset":0,"time_zone":"London","geo_enabled":true,"verified":false,"statuses_count":34447,"lang":"en","contributors_enabled":false,"is_translator":false,"is_translation_enabled":false,"profile_background_color":"C6E2EE","profile_background_image_url":"http://abs.twimg.com/images/themes/theme2/bg.gif","profile_background_image_url_https":"https://abs.twimg.com/images/themes/theme2/bg.gif","profile_background_tile":false,"profile_image_url":"http://pbs.twimg.com/profile_images/1135371649/ddec5b40-1871-4cc7-b8a4-67f0e43dac03_normal.png","profile_image_url_https":"https://pbs.twimg.com/profile_images/1135371649/ddec5b40-1871-4cc7-b8a4-67f0e43dac03_normal.png","profile_banner_url":"https://pbs.twimg.com/profile_banners/50371199/1398209158","profile_link_color":"1F98C7","profile_sidebar_border_color":"C6E2EE","profile_sidebar_fill_color":"DAECF4","profile_text_color":"663B12","profile_use_background_image":true,"has_extended_profile":false,"default_profile":false,"default_profile_image":false,"following":false,"follow_request_sent":false,"notifications":false},"geo":null,"coordinates":null,"place":null,"contributors":null,"is_quote_status":false,"retweet_count":1,"favorite_count":0,"entities":{"hashtags":[{"text":"shame","indices":[129,135]}],"symbols":[],"user_mentions":[{"screen_name":"talktalk","name":"Nami","id":14250126,"id_str":"14250126","indices":[19,28]}],"urls":[]},"favorited":false,"retweeted":false,"lang":"en"},"is_quote_status":false,"retweet_count":1,"favorite_count":0,"entities":{"hashtags":[{"text":"shame","indices":[139,140]}],"symbols":[],"user_mentions":[{"screen_name":"ashic","name":"Ashic Mahtab","id":50371199,"id_str":"50371199","indices":[3,9]},{"screen_name":"talktalk","name":"Nami","id":14250126,"id_str":"14250126","indices":[30,39]}],"urls":[]},"favorited":false,"retweeted":false,"lang":"en"},{"created_at":"Tue Oct 27 09:52:33 +0000 2015","id":658944364580839400,"id_str":"658944364580839424","text":"Looking for a job in a “remote friendly” company? https://t.co/QS0EcdQ0mH - great list of links how to find them.","source":"<a href=\"http://twitter.com\" rel=\"nofollow\">Twitter Web Client</a>","truncated":false,"in_reply_to_status_id":null,"in_reply_to_status_id_str":null,"in_reply_to_user_id":null,"in_reply_to_user_id_str":null,"in_reply_to_screen_name":null,"user":{"id":13567,"id_str":"13567","name":"Christian Heilmann ","screen_name":"codepo8","location":"London, UK","description":"Developer Evangelist - all things open web, HTML5, writing and working together. Works at Microsoft on Edge, opinions totally my own. #nofilter","url":"http://t.co/fQKlvTCkqN","entities":{"url":{"urls":[{"url":"http://t.co/fQKlvTCkqN","expanded_url":"http://christianheilmann.com/2013/02/11/hello-it-is-me-on-twitter/","display_url":"christianheilmann.com/2013/02/11/hel…","indices":[0,22]}]},"description":{"urls":[]}},"protected":false,"followers_count":50224,"friends_count":1467,"listed_count":3684,"created_at":"Tue Nov 21 17:20:09 +0000 2006","favourites_count":285,"utc_offset":0,"time_zone":"London","geo_enabled":true,"verified":false,"statuses_count":104886,"lang":"en","contributors_enabled":false,"is_translator":false,"is_translation_enabled":false,"profile_background_color":"336699","profile_background_image_url":"http://pbs.twimg.com/profile_background_images/64650857/twitterbackground.gif","profile_background_image_url_https":"https://pbs.twimg.com/profile_background_images/64650857/twitterbackground.gif","profile_background_tile":false,"profile_image_url":"http://pbs.twimg.com/profile_images/1666904408/codepo8_normal.png","profile_image_url_https":"https://pbs.twimg.com/profile_images/1666904408/codepo8_normal.png","profile_banner_url":"https://pbs.twimg.com/profile_banners/13567/1409269429","profile_link_color":"13456B","profile_sidebar_border_color":"86A4A6","profile_sidebar_fill_color":"B7CCBB","profile_text_color":"333333","profile_use_background_image":true,"has_extended_profile":false,"default_profile":false,"default_profile_image":false,"following":true,"follow_request_sent":false,"notifications":false},"geo":null,"coordinates":null,"place":null,"contributors":null,"is_quote_status":false,"retweet_count":3,"favorite_count":11,"entities":{"hashtags":[],"symbols":[],"user_mentions":[],"urls":[{"url":"https://t.co/QS0EcdQ0mH","expanded_url":"http://oduinn.com/blog/2015/10/27/looking-for-job-in-remote-friendly-company/","display_url":"oduinn.com/blog/2015/10/2…","indices":[50,73]}]},"favorited":false,"retweeted":false,"possibly_sensitive":false,"possibly_sensitive_appealable":false,"lang":"en"},{"created_at":"Tue Oct 27 09:50:45 +0000 2015","id":658943910962663400,"id_str":"658943910962663424","text":"So after @jina and @stefsull those @salesforce people also bagged @kaelig - good team assembling there.","source":"<a href=\"http://twitter.com\" rel=\"nofollow\">Twitter Web Client</a>","truncated":false,"in_reply_to_status_id":null,"in_reply_to_status_id_str":null,"in_reply_to_user_id":null,"in_reply_to_user_id_str":null,"in_reply_to_screen_name":null,"user":{"id":13567,"id_str":"13567","name":"Christian Heilmann ","screen_name":"codepo8","location":"London, UK","description":"Developer Evangelist - all things open web, HTML5, writing and working together. Works at Microsoft on Edge, opinions totally my own. #nofilter","url":"http://t.co/fQKlvTCkqN","entities":{"url":{"urls":[{"url":"http://t.co/fQKlvTCkqN","expanded_url":"http://christianheilmann.com/2013/02/11/hello-it-is-me-on-twitter/","display_url":"christianheilmann.com/2013/02/11/hel…","indices":[0,22]}]},"description":{"urls":[]}},"protected":false,"followers_count":50224,"friends_count":1467,"listed_count":3684,"created_at":"Tue Nov 21 17:20:09 +0000 2006","favourites_count":285,"utc_offset":0,"time_zone":"London","geo_enabled":true,"verified":false,"statuses_count":104886,"lang":"en","contributors_enabled":false,"is_translator":false,"is_translation_enabled":false,"profile_background_color":"336699","profile_background_image_url":"http://pbs.twimg.com/profile_background_images/64650857/twitterbackground.gif","profile_background_image_url_https":"https://pbs.twimg.com/profile_background_images/64650857/twitterbackground.gif","profile_background_tile":false,"profile_image_url":"http://pbs.twimg.com/profile_images/1666904408/codepo8_normal.png","profile_image_url_https":"https://pbs.twimg.com/profile_images/1666904408/codepo8_normal.png","profile_banner_url":"https://pbs.twimg.com/profile_banners/13567/1409269429","profile_link_color":"13456B","profile_sidebar_border_color":"86A4A6","profile_sidebar_fill_color":"B7CCBB","profile_text_color":"333333","profile_use_background_image":true,"has_extended_profile":false,"default_profile":false,"default_profile_image":false,"following":true,"follow_request_sent":false,"notifications":false},"geo":null,"coordinates":null,"place":{"id":"2a3f152d1ac5044a","url":"https://api.twitter.com/1.1/geo/id/2a3f152d1ac5044a.json","place_type":"city","name":"Hackney","full_name":"Hackney, London","country_code":"GB","country":"United Kingdom","contained_within":[],"bounding_box":{"type":"Polygon","coordinates":[[[-0.104501,51.518605],[-0.015834,51.518605],[-0.015834,51.5766844],[-0.104501,51.5766844]]]},"attributes":{}},"contributors":null,"is_quote_status":false,"retweet_count":0,"favorite_count":1,"entities":{"hashtags":[],"symbols":[],"user_mentions":[{"screen_name":"jina","name":"/\\^₍˄ุ.͡˳̫.˄ุ₎^/\\","id":8501792,"id_str":"8501792","indices":[9,14]},{"screen_name":"stefsull","name":"Stephanie Rewis","id":82433,"id_str":"82433","indices":[19,28]},{"screen_name":"salesforce","name":"Salesforce","id":33612317,"id_str":"33612317","indices":[35,46]},{"screen_name":"kaelig","name":"Kaelig","id":26975453,"id_str":"26975453","indices":[66,73]}],"urls":[]},"favorited":false,"retweeted":false,"lang":"en"},{"created_at":"Tue Oct 27 09:49:34 +0000 2015","id":658943611883536400,"id_str":"658943611883536388","text":"Disrupt London In December Will Feature Many of Europe's EU-nicorns․.. https://t.co/1PmtdafdEm by @mikebutcher","source":"<a href=\"http://10up.com\" rel=\"nofollow\">10up Publish Tweet</a>","truncated":false,"in_reply_to_status_id":null,"in_reply_to_status_id_str":null,"in_reply_to_user_id":null,"in_reply_to_user_id_str":null,"in_reply_to_screen_name":null,"user":{"id":816653,"id_str":"816653","name":"TechCrunch","screen_name":"TechCrunch","location":"San Francisco, CA","description":"Breaking technology news, analysis, and opinions from TechCrunch. The number one guide for all things tech.","url":"http://t.co/b5Oyx12qGG","entities":{"url":{"urls":[{"url":"http://t.co/b5Oyx12qGG","expanded_url":"http://techcrunch.com","display_url":"techcrunch.com","indices":[0,22]}]},"description":{"urls":[]}},"protected":false,"followers_count":5832445,"friends_count":733,"listed_count":100675,"created_at":"Wed Mar 07 01:27:09 +0000 2007","favourites_count":886,"utc_offset":-25200,"time_zone":"Pacific Time (US & Canada)","geo_enabled":true,"verified":true,"statuses_count":111779,"lang":"en","contributors_enabled":false,"is_translator":false,"is_translation_enabled":true,"profile_background_color":"149500","profile_background_image_url":"http://pbs.twimg.com/profile_background_images/621096023751004161/BAKy7hCT.png","profile_background_image_url_https":"https://pbs.twimg.com/profile_background_images/621096023751004161/BAKy7hCT.png","profile_background_tile":false,"profile_image_url":"http://pbs.twimg.com/profile_images/615392662233808896/EtxjSSKk_normal.jpg","profile_image_url_https":"https://pbs.twimg.com/profile_images/615392662233808896/EtxjSSKk_normal.jpg","profile_banner_url":"https://pbs.twimg.com/profile_banners/816653/1431096993","profile_link_color":"097000","profile_sidebar_border_color":"FFFFFF","profile_sidebar_fill_color":"DDFFCC","profile_text_color":"222222","profile_use_background_image":true,"has_extended_profile":false,"default_profile":false,"default_profile_image":false,"following":true,"follow_request_sent":false,"notifications":false},"geo":null,"coordinates":null,"place":null,"contributors":null,"is_quote_status":false,"retweet_count":26,"favorite_count":8,"entities":{"hashtags":[],"symbols":[],"user_mentions":[{"screen_name":"mikebutcher","name":"Mike Butcher","id":13666,"id_str":"13666","indices":[98,110]}],"urls":[{"url":"https://t.co/1PmtdafdEm","expanded_url":"http://tcrn.ch/1Lz10mf","display_url":"tcrn.ch/1Lz10mf","indices":[71,94]}]},"favorited":false,"retweeted":false,"possibly_sensitive":false,"possibly_sensitive_appealable":false,"lang":"en"},{"created_at":"Tue Oct 27 09:47:33 +0000 2015","id":658943105010442200,"id_str":"658943105010442241","text":"Yes, this is the better way to display images. Maybe. https://t.co/uLv9GMbYcX","source":"<a href=\"http://twitter.com\" rel=\"nofollow\">Twitter Web Client</a>","truncated":false,"in_reply_to_status_id":null,"in_reply_to_status_id_str":null,"in_reply_to_user_id":null,"in_reply_to_user_id_str":null,"in_reply_to_screen_name":null,"user":{"id":13567,"id_str":"13567","name":"Christian Heilmann ","screen_name":"codepo8","location":"London, UK","description":"Developer Evangelist - all things open web, HTML5, writing and working together. Works at Microsoft on Edge, opinions totally my own. #nofilter","url":"http://t.co/fQKlvTCkqN","entities":{"url":{"urls":[{"url":"http://t.co/fQKlvTCkqN","expanded_url":"http://christianheilmann.com/2013/02/11/hello-it-is-me-on-twitter/","display_url":"christianheilmann.com/2013/02/11/hel…","indices":[0,22]}]},"description":{"urls":[]}},"protected":false,"followers_count":50224,"friends_count":1467,"listed_count":3684,"created_at":"Tue Nov 21 17:20:09 +0000 2006","favourites_count":285,"utc_offset":0,"time_zone":"London","geo_enabled":true,"verified":false,"statuses_count":104886,"lang":"en","contributors_enabled":false,"is_translator":false,"is_translation_enabled":false,"profile_background_color":"336699","profile_background_image_url":"http://pbs.twimg.com/profile_background_images/64650857/twitterbackground.gif","profile_background_image_url_https":"https://pbs.twimg.com/profile_background_images/64650857/twitterbackground.gif","profile_background_tile":false,"profile_image_url":"http://pbs.twimg.com/profile_images/1666904408/codepo8_normal.png","profile_image_url_https":"https://pbs.twimg.com/profile_images/1666904408/codepo8_normal.png","profile_banner_url":"https://pbs.twimg.com/profile_banners/13567/1409269429","profile_link_color":"13456B","profile_sidebar_border_color":"86A4A6","profile_sidebar_fill_color":"B7CCBB","profile_text_color":"333333","profile_use_background_image":true,"has_extended_profile":false,"default_profile":false,"default_profile_image":false,"following":true,"follow_request_sent":false,"notifications":false},"geo":null,"coordinates":null,"place":{"id":"2a3f152d1ac5044a","url":"https://api.twitter.com/1.1/geo/id/2a3f152d1ac5044a.json","place_type":"city","name":"Hackney","full_name":"Hackney, London","country_code":"GB","country":"United Kingdom","contained_within":[],"bounding_box":{"type":"Polygon","coordinates":[[[-0.104501,51.518605],[-0.015834,51.518605],[-0.015834,51.5766844],[-0.104501,51.5766844]]]},"attributes":{}},"contributors":null,"is_quote_status":false,"retweet_count":0,"favorite_count":4,"entities":{"hashtags":[],"symbols":[],"user_mentions":[],"urls":[],"media":[{"id":658943104091865100,"id_str":"658943104091865089","indices":[54,77],"media_url":"http://pbs.twimg.com/media/CSUJQw6WwAEvKMM.png","media_url_https":"https://pbs.twimg.com/media/CSUJQw6WwAEvKMM.png","url":"https://t.co/uLv9GMbYcX","display_url":"pic.twitter.com/uLv9GMbYcX","expanded_url":"http://twitter.com/codepo8/status/658943105010442241/photo/1","type":"photo","sizes":{"large":{"w":958,"h":299,"resize":"fit"},"thumb":{"w":150,"h":150,"resize":"crop"},"small":{"w":340,"h":106,"resize":"fit"},"medium":{"w":600,"h":187,"resize":"fit"}}}]},"extended_entities":{"media":[{"id":658943104091865100,"id_str":"658943104091865089","indices":[54,77],"media_url":"http://pbs.twimg.com/media/CSUJQw6WwAEvKMM.png","media_url_https":"https://pbs.twimg.com/media/CSUJQw6WwAEvKMM.png","url":"https://t.co/uLv9GMbYcX","display_url":"pic.twitter.com/uLv9GMbYcX","expanded_url":"http://twitter.com/codepo8/status/658943105010442241/photo/1","type":"photo","sizes":{"large":{"w":958,"h":299,"resize":"fit"},"thumb":{"w":150,"h":150,"resize":"crop"},"small":{"w":340,"h":106,"resize":"fit"},"medium":{"w":600,"h":187,"resize":"fit"}}}]},"favorited":false,"retweeted":false,"possibly_sensitive":false,"possibly_sensitive_appealable":false,"lang":"en"},{"created_at":"Tue Oct 27 09:46:02 +0000 2015","id":658942722733154300,"id_str":"658942722733154304","text":"Why BPG will replace GIFs and not only. - https://t.co/VU5RwvGC3v via @raduamarie - another new image container format. depacked in JS :/","source":"<a href=\"http://twitter.com\" rel=\"nofollow\">Twitter Web Client</a>","truncated":false,"in_reply_to_status_id":null,"in_reply_to_status_id_str":null,"in_reply_to_user_id":null,"in_reply_to_user_id_str":null,"in_reply_to_screen_name":null,"user":{"id":13567,"id_str":"13567","name":"Christian Heilmann ","screen_name":"codepo8","location":"London, UK","description":"Developer Evangelist - all things open web, HTML5, writing and working together. Works at Microsoft on Edge, opinions totally my own. #nofilter","url":"http://t.co/fQKlvTCkqN","entities":{"url":{"urls":[{"url":"http://t.co/fQKlvTCkqN","expanded_url":"http://christianheilmann.com/2013/02/11/hello-it-is-me-on-twitter/","display_url":"christianheilmann.com/2013/02/11/hel…","indices":[0,22]}]},"description":{"urls":[]}},"protected":false,"followers_count":50224,"friends_count":1467,"listed_count":3684,"created_at":"Tue Nov 21 17:20:09 +0000 2006","favourites_count":285,"utc_offset":0,"time_zone":"London","geo_enabled":true,"verified":false,"statuses_count":104886,"lang":"en","contributors_enabled":false,"is_translator":false,"is_translation_enabled":false,"profile_background_color":"336699","profile_background_image_url":"http://pbs.twimg.com/profile_background_images/64650857/twitterbackground.gif","profile_background_image_url_https":"https://pbs.twimg.com/profile_background_images/64650857/twitterbackground.gif","profile_background_tile":false,"profile_image_url":"http://pbs.twimg.com/profile_images/1666904408/codepo8_normal.png","profile_image_url_https":"https://pbs.twimg.com/profile_images/1666904408/codepo8_normal.png","profile_banner_url":"https://pbs.twimg.com/profile_banners/13567/1409269429","profile_link_color":"13456B","profile_sidebar_border_color":"86A4A6","profile_sidebar_fill_color":"B7CCBB","profile_text_color":"333333","profile_use_background_image":true,"has_extended_profile":false,"default_profile":false,"default_profile_image":false,"following":true,"follow_request_sent":false,"notifications":false},"geo":null,"coordinates":null,"place":null,"contributors":null,"is_quote_status":false,"retweet_count":2,"favorite_count":2,"entities":{"hashtags":[],"symbols":[],"user_mentions":[{"screen_name":"raduamarie","name":"Radu-S. Amarie","id":49024219,"id_str":"49024219","indices":[70,81]}],"urls":[{"url":"https://t.co/VU5RwvGC3v","expanded_url":"http://goo.gl/ZiDgHV","display_url":"goo.gl/ZiDgHV","indices":[42,65]}]},"favorited":false,"retweeted":false,"possibly_sensitive":false,"possibly_sensitive_appealable":false,"lang":"en"},{"created_at":"Tue Oct 27 09:42:06 +0000 2015","id":658941734139875300,"id_str":"658941734139875329","text":".@realDonaldJS There are Haskell fundamentalists who uh have training camps and uh, what I mean is, when can we get rid of them?","source":"<a href=\"http://www.twitter.com\" rel=\"nofollow\">Twitter for Windows Phone</a>","truncated":false,"in_reply_to_status_id":655468867779739600,"in_reply_to_status_id_str":"655468867779739648","in_reply_to_user_id":3981786520,"in_reply_to_user_id_str":"3981786520","in_reply_to_screen_name":"realDonaldJS","user":{"id":160514302,"id_str":"160514302","name":"Richard Dalton","screen_name":"richardadalton","location":"Kildare, Ireland","description":"I write code, as a last resort. I make it simple, when I can. Please visit: http://t.co/GtWXf7dbfa","url":"http://t.co/mArwXmywZl","entities":{"url":{"urls":[{"url":"http://t.co/mArwXmywZl","expanded_url":"http://www.devjoy.com","display_url":"devjoy.com","indices":[0,22]}]},"description":{"urls":[{"url":"http://t.co/GtWXf7dbfa","expanded_url":"http://freepaconow.com","display_url":"freepaconow.com","indices":[76,98]}]}},"protected":false,"followers_count":1069,"friends_count":504,"listed_count":97,"created_at":"Mon Jun 28 11:27:14 +0000 2010","favourites_count":231,"utc_offset":null,"time_zone":null,"geo_enabled":true,"verified":false,"statuses_count":28390,"lang":"en","contributors_enabled":false,"is_translator":false,"is_translation_enabled":false,"profile_background_color":"C0DEED","profile_background_image_url":"http://pbs.twimg.com/profile_background_images/687927535/b2ebf72ba8fc96d4e126d2810c37467a.jpeg","profile_background_image_url_https":"https://pbs.twimg.com/profile_background_images/687927535/b2ebf72ba8fc96d4e126d2810c37467a.jpeg","profile_background_tile":false,"profile_image_url":"http://pbs.twimg.com/profile_images/629300041455435776/dCbJf6WT_normal.jpg","profile_image_url_https":"https://pbs.twimg.com/profile_images/629300041455435776/dCbJf6WT_normal.jpg","profile_banner_url":"https://pbs.twimg.com/profile_banners/160514302/1357347025","profile_link_color":"0084B4","profile_sidebar_border_color":"FFFFFF","profile_sidebar_fill_color":"DDEEF6","profile_text_color":"333333","profile_use_background_image":true,"has_extended_profile":false,"default_profile":false,"default_profile_image":false,"following":true,"follow_request_sent":false,"notifications":false},"geo":null,"coordinates":null,"place":null,"contributors":null,"is_quote_status":false,"retweet_count":0,"favorite_count":0,"entities":{"hashtags":[],"symbols":[],"user_mentions":[{"screen_name":"realDonaldJS","name":"Trump on JavaScript","id":3981786520,"id_str":"3981786520","indices":[1,14]}],"urls":[]},"favorited":false,"retweeted":false,"lang":"en"},{"created_at":"Tue Oct 27 09:39:48 +0000 2015","id":658941153253937200,"id_str":"658941153253937152","text":"White on light grey. Oh @HuaweiDevice, you spoil me. https://t.co/Y5FdZ9Squr","source":"<a href=\"http://twitter.com/download/android\" rel=\"nofollow\">Twitter for Android</a>","truncated":false,"in_reply_to_status_id":null,"in_reply_to_status_id_str":null,"in_reply_to_user_id":null,"in_reply_to_user_id_str":null,"in_reply_to_screen_name":null,"user":{"id":13567,"id_str":"13567","name":"Christian Heilmann ","screen_name":"codepo8","location":"London, UK","description":"Developer Evangelist - all things open web, HTML5, writing and working together. Works at Microsoft on Edge, opinions totally my own. #nofilter","url":"http://t.co/fQKlvTCkqN","entities":{"url":{"urls":[{"url":"http://t.co/fQKlvTCkqN","expanded_url":"http://christianheilmann.com/2013/02/11/hello-it-is-me-on-twitter/","display_url":"christianheilmann.com/2013/02/11/hel…","indices":[0,22]}]},"description":{"urls":[]}},"protected":false,"followers_count":50224,"friends_count":1467,"listed_count":3684,"created_at":"Tue Nov 21 17:20:09 +0000 2006","favourites_count":285,"utc_offset":0,"time_zone":"London","geo_enabled":true,"verified":false,"statuses_count":104886,"lang":"en","contributors_enabled":false,"is_translator":false,"is_translation_enabled":false,"profile_background_color":"336699","profile_background_image_url":"http://pbs.twimg.com/profile_background_images/64650857/twitterbackground.gif","profile_background_image_url_https":"https://pbs.twimg.com/profile_background_images/64650857/twitterbackground.gif","profile_background_tile":false,"profile_image_url":"http://pbs.twimg.com/profile_images/1666904408/codepo8_normal.png","profile_image_url_https":"https://pbs.twimg.com/profile_images/1666904408/codepo8_normal.png","profile_banner_url":"https://pbs.twimg.com/profile_banners/13567/1409269429","profile_link_color":"13456B","profile_sidebar_border_color":"86A4A6","profile_sidebar_fill_color":"B7CCBB","profile_text_color":"333333","profile_use_background_image":true,"has_extended_profile":false,"default_profile":false,"default_profile_image":false,"following":true,"follow_request_sent":false,"notifications":false},"geo":null,"coordinates":null,"place":{"id":"2a3f152d1ac5044a","url":"https://api.twitter.com/1.1/geo/id/2a3f152d1ac5044a.json","place_type":"city","name":"Hackney","full_name":"Hackney, London","country_code":"GB","country":"United Kingdom","contained_within":[],"bounding_box":{"type":"Polygon","coordinates":[[[-0.104501,51.518605],[-0.015834,51.518605],[-0.015834,51.5766844],[-0.104501,51.5766844]]]},"attributes":{}},"contributors":null,"is_quote_status":false,"retweet_count":1,"favorite_count":3,"entities":{"hashtags":[],"symbols":[],"user_mentions":[{"screen_name":"HuaweiDevice","name":"Huawei Device","id":167324989,"id_str":"167324989","indices":[24,37]}],"urls":[],"media":[{"id":658941151802691600,"id_str":"658941151802691585","indices":[53,76],"media_url":"http://pbs.twimg.com/media/CSUHfIEWEAEAR8K.jpg","media_url_https":"https://pbs.twimg.com/media/CSUHfIEWEAEAR8K.jpg","url":"https://t.co/Y5FdZ9Squr","display_url":"pic.twitter.com/Y5FdZ9Squr","expanded_url":"http://twitter.com/codepo8/status/658941153253937152/photo/1","type":"photo","sizes":{"large":{"w":1024,"h":548,"resize":"fit"},"medium":{"w":600,"h":321,"resize":"fit"},"thumb":{"w":150,"h":150,"resize":"crop"},"small":{"w":340,"h":181,"resize":"fit"}}}]},"extended_entities":{"media":[{"id":658941151802691600,"id_str":"658941151802691585","indices":[53,76],"media_url":"http://pbs.twimg.com/media/CSUHfIEWEAEAR8K.jpg","media_url_https":"https://pbs.twimg.com/media/CSUHfIEWEAEAR8K.jpg","url":"https://t.co/Y5FdZ9Squr","display_url":"pic.twitter.com/Y5FdZ9Squr","expanded_url":"http://twitter.com/codepo8/status/658941153253937152/photo/1","type":"photo","sizes":{"large":{"w":1024,"h":548,"resize":"fit"},"medium":{"w":600,"h":321,"resize":"fit"},"thumb":{"w":150,"h":150,"resize":"crop"},"small":{"w":340,"h":181,"resize":"fit"}}}]},"favorited":false,"retweeted":false,"possibly_sensitive":false,"possibly_sensitive_appealable":false,"lang":"en"},{"created_at":"Tue Oct 27 09:39:26 +0000 2015","id":658941063298752500,"id_str":"658941063298752512","text":"RT @Julieanne: First @ffconf cash n carry run on my own without @rem or a baby attached to me / running around :(","source":"<a href=\"http://twitter.com/download/android\" rel=\"nofollow\">Twitter for Android</a>","truncated":false,"in_reply_to_status_id":null,"in_reply_to_status_id_str":null,"in_reply_to_user_id":null,"in_reply_to_user_id_str":null,"in_reply_to_screen_name":null,"user":{"id":648873,"id_str":"648873","name":"Remy Sharp","screen_name":"rem","location":"Brighton, UK","description":"All about CSS sizing units.","url":"http://t.co/BWhhcur8tM","entities":{"url":{"urls":[{"url":"http://t.co/BWhhcur8tM","expanded_url":"http://remysharp.com","display_url":"remysharp.com","indices":[0,22]}]},"description":{"urls":[]}},"protected":false,"followers_count":42376,"friends_count":330,"listed_count":3205,"created_at":"Tue Jan 16 20:11:35 +0000 2007","favourites_count":4822,"utc_offset":0,"time_zone":"Europe/London","geo_enabled":true,"verified":false,"statuses_count":53307,"lang":"en","contributors_enabled":false,"is_translator":false,"is_translation_enabled":false,"profile_background_color":"FFFFFF","profile_background_image_url":"http://pbs.twimg.com/profile_background_images/3983564/twitter-peel2.jpg","profile_background_image_url_https":"https://pbs.twimg.com/profile_background_images/3983564/twitter-peel2.jpg","profile_background_tile":false,"profile_image_url":"http://pbs.twimg.com/profile_images/527584017189982208/l3wwN-l-_normal.jpeg","profile_image_url_https":"https://pbs.twimg.com/profile_images/527584017189982208/l3wwN-l-_normal.jpeg","profile_banner_url":"https://pbs.twimg.com/profile_banners/648873/1348677426","profile_link_color":"0000FF","profile_sidebar_border_color":"E0E0E0","profile_sidebar_fill_color":"F5F4F4","profile_text_color":"000000","profile_use_background_image":true,"has_extended_profile":false,"default_profile":false,"default_profile_image":false,"following":true,"follow_request_sent":false,"notifications":false},"geo":null,"coordinates":null,"place":null,"contributors":null,"retweeted_status":{"created_at":"Tue Oct 27 08:38:01 +0000 2015","id":658925605031956500,"id_str":"658925605031956480","text":"First @ffconf cash n carry run on my own without @rem or a baby attached to me / running around :(","source":"<a href=\"http://tapbots.com/tweetbot\" rel=\"nofollow\">Tweetbot for iΟS</a>","truncated":false,"in_reply_to_status_id":null,"in_reply_to_status_id_str":null,"in_reply_to_user_id":null,"in_reply_to_user_id_str":null,"in_reply_to_screen_name":null,"user":{"id":1235161,"id_str":"1235161","name":"Julie Sharp","screen_name":"Julieanne","location":"Brighton","description":"Wife of @rem, mum to 2 amazingly energetic kids & our sleeping beauty Tia, employee of @leftlogic, co-organiser of @ffconf. Available for freelance event work.","url":null,"entities":{"description":{"urls":[]}},"protected":false,"followers_count":545,"friends_count":308,"listed_count":37,"created_at":"Thu Mar 15 17:15:31 +0000 2007","favourites_count":977,"utc_offset":0,"time_zone":"London","geo_enabled":false,"verified":false,"statuses_count":5418,"lang":"en","contributors_enabled":false,"is_translator":false,"is_translation_enabled":false,"profile_background_color":"1A1B1F","profile_background_image_url":"http://abs.twimg.com/images/themes/theme9/bg.gif","profile_background_image_url_https":"https://abs.twimg.com/images/themes/theme9/bg.gif","profile_background_tile":false,"profile_image_url":"http://pbs.twimg.com/profile_images/28483872/Julie_in_kitchen_normal.jpg","profile_image_url_https":"https://pbs.twimg.com/profile_images/28483872/Julie_in_kitchen_normal.jpg","profile_link_color":"2FC2EF","profile_sidebar_border_color":"181A1E","profile_sidebar_fill_color":"252429","profile_text_color":"666666","profile_use_background_image":true,"has_extended_profile":false,"default_profile":false,"default_profile_image":false,"following":false,"follow_request_sent":false,"notifications":false},"geo":null,"coordinates":null,"place":null,"contributors":null,"is_quote_status":false,"retweet_count":1,"favorite_count":0,"entities":{"hashtags":[],"symbols":[],"user_mentions":[{"screen_name":"ffconf","name":"ffconf","id":26049747,"id_str":"26049747","indices":[6,13]},{"screen_name":"rem","name":"Remy Sharp","id":648873,"id_str":"648873","indices":[49,53]}],"urls":[]},"favorited":false,"retweeted":false,"lang":"en"},"is_quote_status":false,"retweet_count":1,"favorite_count":0,"entities":{"hashtags":[],"symbols":[],"user_mentions":[{"screen_name":"Julieanne","name":"Julie Sharp","id":1235161,"id_str":"1235161","indices":[3,13]},{"screen_name":"ffconf","name":"ffconf","id":26049747,"id_str":"26049747","indices":[21,28]},{"screen_name":"rem","name":"Remy Sharp","id":648873,"id_str":"648873","indices":[64,68]}],"urls":[]},"favorited":false,"retweeted":false,"lang":"en"},{"created_at":"Tue Oct 27 09:39:05 +0000 2015","id":658940974220070900,"id_str":"658940974220070912","text":"The American Egg Board may have used public funds to conspire against Hampton Creek https://t.co/BqWFnHnh96","source":"<a href=\"http://www.socialflow.com\" rel=\"nofollow\">SocialFlow</a>","truncated":false,"in_reply_to_status_id":null,"in_reply_to_status_id_str":null,"in_reply_to_user_id":null,"in_reply_to_user_id_str":null,"in_reply_to_screen_name":null,"user":{"id":816653,"id_str":"816653","name":"TechCrunch","screen_name":"TechCrunch","location":"San Francisco, CA","description":"Breaking technology news, analysis, and opinions from TechCrunch. The number one guide for all things tech.","url":"http://t.co/b5Oyx12qGG","entities":{"url":{"urls":[{"url":"http://t.co/b5Oyx12qGG","expanded_url":"http://techcrunch.com","display_url":"techcrunch.com","indices":[0,22]}]},"description":{"urls":[]}},"protected":false,"followers_count":5832445,"friends_count":733,"listed_count":100675,"created_at":"Wed Mar 07 01:27:09 +0000 2007","favourites_count":886,"utc_offset":-25200,"time_zone":"Pacific Time (US & Canada)","geo_enabled":true,"verified":true,"statuses_count":111779,"lang":"en","contributors_enabled":false,"is_translator":false,"is_translation_enabled":true,"profile_background_color":"149500","profile_background_image_url":"http://pbs.twimg.com/profile_background_images/621096023751004161/BAKy7hCT.png","profile_background_image_url_https":"https://pbs.twimg.com/profile_background_images/621096023751004161/BAKy7hCT.png","profile_background_tile":false,"profile_image_url":"http://pbs.twimg.com/profile_images/615392662233808896/EtxjSSKk_normal.jpg","profile_image_url_https":"https://pbs.twimg.com/profile_images/615392662233808896/EtxjSSKk_normal.jpg","profile_banner_url":"https://pbs.twimg.com/profile_banners/816653/1431096993","profile_link_color":"097000","profile_sidebar_border_color":"FFFFFF","profile_sidebar_fill_color":"DDFFCC","profile_text_color":"222222","profile_use_background_image":true,"has_extended_profile":false,"default_profile":false,"default_profile_image":false,"following":true,"follow_request_sent":false,"notifications":false},"geo":null,"coordinates":null,"place":null,"contributors":null,"is_quote_status":false,"retweet_count":30,"favorite_count":7,"entities":{"hashtags":[],"symbols":[],"user_mentions":[],"urls":[{"url":"https://t.co/BqWFnHnh96","expanded_url":"http://tcrn.ch/1jMi7rP","display_url":"tcrn.ch/1jMi7rP","indices":[84,107]}]},"favorited":false,"retweeted":false,"possibly_sensitive":false,"possibly_sensitive_appealable":false,"lang":"en"}];
  // res.status(200).json(tweetToHTML.parse(tweets));
});

// catch 404 and forward to error handler
app.use(function(req, res, next) {
  var err = new Error('Not Found');
  err.status = 404;
  next(err);
});

// error handlers

// development error handler
// will print stacktrace
if (app.get('env') === 'development') {
  app.use(function(err, req, res, next) {
    res.status(err.status || 500);
    res.render('error', {
      message: err.message,
      error: err
    });
  });
}

// production error handler
// no stacktraces leaked to user
app.use(function(err, req, res, next) {
  res.status(err.status || 500);
  res.render('error', {
    message: err.message,
    error: {}
  });
});

module.exports = app;
